<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Tetris</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Basic, light CSS tuned for canvas rendering -->
  <style>
    :root {
      --cell: 20px;
      /* board cell size (canvas draws with this) */
      --cols: 10;
      --rows: 20;
      --mono: ui-monospace, "Cascadia Mono", Menlo, Consolas, monospace;
      --grid-border: #ccc;
      --active-outline: #e67e22;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 12px 12px 48px;
      font-family: var(--mono);
      color: #111;
      background: #fff;
    }

    h1 {
      margin: 0 0 10px;
      font-weight: 800;
      letter-spacing: 1px;
    }

    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .toolbar .group {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .toolbar button {
      font-family: var(--mono);
      padding: 4px 8px;
    }

    .layout {
      display: grid;
      grid-template-columns: auto 260px 1fr;
      gap: 24px;
      align-items: start;
    }

    /* Board area */
    .board-wrap {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #boardCanvas {
      width: calc(var(--cols) * var(--cell));
      height: calc(var(--rows) * var(--cell));
      border: 1px solid var(--grid-border);
      background: #fff;
      box-shadow: inset 0 0 0 1px #eee;
    }

    /* Sidebar */
    .sidebar {
      display: grid;
      gap: 10px;
      align-content: start;
    }

    .label {
      font-weight: 700;
    }

    #nextCanvas {
      width: 100px;
      height: 100px;
      border: 2px solid #888;
      border-radius: 8px;
      background: #f6f6f9;
    }

    #gameStats {
      font-size: 13px;
      color: #444;
      background: #eef;
      padding: 8px 10px;
      border-radius: 6px;
      min-height: 38px;
    }

    /* High scores list */
    .scores {
      min-width: 200px;
    }

    .scores h3 {
      margin: 0 0 6px;
    }

    #highScores {
      margin: 0;
      padding-left: 20px;
    }

    #highScores li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 180px;
    }

    #highScores li span:first-child {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 110px;
    }

    /* Soft controls */
    .soft-keys {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .soft-keys button {
      font-family: var(--mono);
      padding: 6px 10px;
    }

    /* Fireworks overlay */
    #fireworks {
      display: none;
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 2000;
    }

    /* Name prompt */
    #playerNamePrompt {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, .4);
      z-index: 1000;
    }

    #playerNamePrompt .dialog {
      background: #fff;
      padding: 24px 32px;
      border-radius: 10px;
      box-shadow: 0 2px 12px #0003;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: stretch;
      min-width: 260px;
    }

    #playerNamePrompt input {
      padding: 6px 8px;
      font-family: var(--mono);
    }

    #resetHighScoresBtn {
      position: fixed;
      bottom: 12px;
      left: 12px;
      z-index: 9999;
      opacity: .35;
      font-size: 12px;
      padding: 4px 10px;
      background: #eee;
      border: 1px solid #bbb;
      border-radius: 6px;
      color: #444;
      cursor: pointer;
      transition: opacity .2s;
    }

    #resetHighScoresBtn:hover {
      opacity: .7;
    }

    noscript {
      display: block;
      margin: 20px 0;
      padding: 10px;
      background: #fff4d6;
      border: 1px solid #f0d48a;
    }
  </style>

  <!-- Preload module graph (optional but nice on Pages) -->
  <link rel="modulepreload" href="./main.js">
  <link rel="modulepreload" href="./engine.js">
  <link rel="modulepreload" href="./ai.js">
  <link rel="modulepreload" href="./ui.js">
</head>

<body>
  <h1>Tetris</h1>

  <div class="toolbar">
    <div class="group">Score: <span id="score">0</span></div>
    <div class="group"><button id="btnNew">New Game</button></div>
    <div class="group"><button id="autoBtn">Auto Play</button></div>
    <div class="group" role="radiogroup" aria-label="Speed">
      <span>Speed:</span>
      <label><input type="radio" name="speedMode" value="Slow" checked> Slow</label>
      <label><input type="radio" name="speedMode" value="Normal"> Normal</label>
      <label><input type="radio" name="speedMode" value="Fast"> Fast</label>
      <label><input type="radio" name="speedMode" value="Impossible"> Impossible</label>
    </div>
  </div>

  <div class="layout">
    <!-- LEFT: Board + soft controls -->
    <div class="board-wrap">
      <!-- High-performance canvas board (10Ã—20 cells @ 20px default) -->
      <canvas id="boardCanvas" width="200" height="400" aria-label="Tetris board"></canvas>

      <div class="soft-keys">
        <button id="btnLeft">Left</button>
        <button id="btnRotate">Rotate</button>
        <button id="btnRight">Right</button>
        <button id="btnDrop">Drop</button>
      </div>
    </div>

    <!-- MIDDLE: Next piece + stats -->
    <div class="sidebar">
      <div class="label">Next Piece:</div>
      <canvas id="nextCanvas" width="100" height="100" aria-hidden="true"></canvas>
      <div id="gameStats"></div>
    </div>

    <!-- RIGHT: High scores -->
    <div class="scores">
      <h3>High Scores</h3>
      <ol id="highScores"></ol>
    </div>
  </div>

  <!-- Fireworks overlay -->
  <canvas id="fireworks"></canvas>

  <!-- Hidden storage for base64-encoded highscores (kept for backward compat) -->
  <textarea id="highScoresData" style="display:none;width:100%;height:40px;"></textarea>

  <button id="resetHighScoresBtn" title="Clear high scores (local only)">Reset High Scores</button>

  <!-- Name prompt -->
  <div id="playerNamePrompt" role="dialog" aria-modal="true" aria-labelledby="dlgTitle">
    <div class="dialog">
      <div id="dlgTitle" style="font-weight:bold;">New High Score!</div>
      <label for="playerNameInput">Enter your name:</label>
      <input id="playerNameInput" maxlength="24" autocomplete="name" />
      <button id="btnNameOk">OK</button>
    </div>
  </div>

  <noscript>This game requires JavaScript. Please enable it to play.</noscript>

  <!-- Load the app (ES modules). This is the only script tag you need on Pages. -->
  <script type="module" src="./main.js"></script>
</body>

</html>